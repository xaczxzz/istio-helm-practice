# Prometheus Stack Helm Values

# Prometheus configuration
prometheus:
  prometheusSpec:
    # Enable service discovery for all namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false
    
    # Retention settings
    retention: 7d
    retentionSize: "10GB"
    
    # Storage configuration (for local development)
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi
    
    # Resource limits
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "2000m"
    
    # Additional scrape configs for Istio
    additionalScrapeConfigs:
      - job_name: 'istio-mesh'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
            - istio-system
        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-proxy;http-monitoring
      
      - job_name: 'istio-policy'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
            - istio-system
        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-policy;http-monitoring
      
      - job_name: 'istio-telemetry'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
            - istio-system
        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-telemetry;http-monitoring

# Grafana configuration
grafana:
  enabled: true
  
  # Admin credentials
  adminPassword: "admin123"
  
  # Service configuration
  service:
    type: ClusterIP
    port: 80
  
  # Ingress configuration (disabled for local development)
  ingress:
    enabled: false
  
  # Persistence (disabled for local development)
  persistence:
    enabled: false
  
  # Resource limits
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"
  
  # Grafana configuration
  grafana.ini:
    server:
      root_url: "http://localhost:3000"
      serve_from_sub_path: true
    auth.anonymous:
      enabled: true
      org_role: Viewer
    security:
      allow_embedding: true
  
  # Default dashboards
  defaultDashboardsEnabled: true
  
  # Additional data sources
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki:3100
      access: proxy
      isDefault: false
    - name: Jaeger
      type: jaeger
      url: http://tracing:16686
      access: proxy
      isDefault: false

# AlertManager configuration
alertmanager:
  enabled: true
  
  alertmanagerSpec:
    # Resource limits
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "500m"
    
    # Storage (disabled for local development)
    storage:
      volumeClaimTemplate:
        spec:
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 1Gi

# Node Exporter configuration
nodeExporter:
  enabled: true

# Kube State Metrics configuration
kubeStateMetrics:
  enabled: true

# Prometheus Operator configuration
prometheusOperator:
  enabled: true
  
  # Resource limits
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"