# Default values for k8s-3tier-app umbrella chart

global:
  registry: "kind-registry:5000" 
  imageTag: "v1"
  imagePullPolicy: "IfNotPresent"
  
  # Database configuration
  database:
    host: "postgresql"
    port: 5432
    username: "postgres"
    password: "postgres"
  
  # Observability configuration
  observability:
    jaeger:
      endpoint: "jaeger"
      port: 6831
    prometheus:
      enabled: true
    tracing:
      enabled: true
      sampling: 100.0

# PostgreSQL configuration (ArgoCD로 별도 관리하므로 비활성화)
postgresql:
  enabled: true
  replicaCount: 1

# Frontend configuration
frontend:
  enabled: true
  replicaCount: 1
  image:
    repository: "kind-registry:5000/frontend"  # ✅ 수정
    tag: "v1"
    pullPolicy: "IfNotPresent"
  service:
    type: ClusterIP
    port: 80
  ingress:
    enabled: false  # ✅ 추가
  serviceAccount:
    create: false
    automount: true
    annotations: {}
    name: ""
  httpRoute:
    enabled: false
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
  ingress:
    enabled: false
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"    # 128Mi → 256Mi로 증가
      cpu: "500m"        # 200m → 500m로 증가

# API Gateway configuration
api-gateway:
  enabled: true
  replicaCount: 1
  image:
    repository: "kind-registry:5000/api-gateway"  # ✅ 수정
    tag: "v1"
    pullPolicy: "IfNotPresent"
  service:
    type: ClusterIP
    port: 8000
  ingress:
    enabled: false  # ✅ 추가
  serviceAccount:
    create: false
    automount: true
    annotations: {}
    name: ""
  httpRoute:
    enabled: false
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
  ingress:
    enabled: false
  env:  # ✅ 이거 추가
    ORDER_SERVICE_URL: "http://app-stack-order-service:8080"
    INVENTORY_SERVICE_URL: "http://app-stack-inventory-service:3000"
    USER_SERVICE_URL: "http://app-stack-user-service:8000"
    JAEGER_AGENT_HOST: "jaeger-agent.istio-system.svc.cluster.local"
    JAEGER_AGENT_PORT: "6831"
    PROMETHEUS_URL: "http://monitoring-stack-kube-prom-prometheus.monitoring.svc.cluster.local:9090"
    GRAFANA_URL: "http://monitoring-stack-grafana.monitoring.svc.cluster.local:80"
    JAEGER_URL: "http://jaeger-query.istio-system.svc.cluster.local:16686"
    KIALI_URL: "http://kiali.istio-system.svc.cluster.local:20001"
    
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

# Order Service configuration
order-service:
  enabled: true
  replicaCount: 2
  image:
    repository: "kind-registry:5000/order-service"  # ✅ 수정
    tag: "v1"
    pullPolicy: "IfNotPresent"
  service:
    type: ClusterIP
    port: 8080
  ingress:
    enabled: false  # ✅ 추가
  serviceAccount:
    create: false
    automount: true
    annotations: {}
    name: ""
  httpRoute:
    enabled: false
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
  ingress:
    enabled: false
  env:
    DB_HOST: "postgresql"
    DB_PORT: "5432"
    DB_NAME: "postgres"
    DB_USER: "postgres"
    DB_PASSWORD: "postgres"
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "512Mi"
      cpu: "1000m"

# Inventory Service configuration
inventory-service:
  enabled: true
  replicaCount: 2
  image:
    repository: "kind-registry:5000/inventory-service"  # ✅ 수정
    tag: "v1"
    pullPolicy: "IfNotPresent"
  service:
    type: ClusterIP
    port: 3000
  ingress:
    enabled: false  # ✅ 추가
  serviceAccount:
    create: false
    automount: true
    annotations: {}
    name: ""
  httpRoute:
    enabled: false
  env:
    DB_HOST: "postgresql"
    DB_PORT: "5432"
    DB_NAME: "postgres"
    DB_USER: "postgres"
    DB_PASSWORD: "postgres"
    SERVICE_VERSION: "v1.0.0"
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"

# User Service configuration
user-service:
  enabled: true
  replicaCount: 2
  image:
    repository: "kind-registry:5000/user-service"  # ✅ 수정
    tag: "v1"
    pullPolicy: "IfNotPresent"
  service:
    type: ClusterIP
    port: 8000
  ingress:
    enabled: false  # ✅ 추가
  serviceAccount:
    create: false
    automount: true
    annotations: {}
    name: ""
  httpRoute:
    enabled: false
  env:
    DB_HOST: "postgresql"
    DB_PORT: "5432"
    DB_NAME: "postgres"
    DB_USER: "postgres"
    DB_PASSWORD: "postgres"
    SERVICE_VERSION: "v1.0.0"
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "500m"